<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.25">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Daianna Gonzalez-Padilla">
<meta name="dcterms.date" content="2025-02-07">
<meta name="description" content="Graphical illustration and mathematical proof of the uniform distribution of p-values">

<title>Why are p-values uniformly distributed? ‚Äì Daianna Gonzalez-Padilla</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../images/logo-removebg.png" rel="icon" type="image/png">
<script src="../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-7b89279ff1a6dce999919e0e67d4d9ec.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-5b4ad623e5705c0698d39aec6f10cf02.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN" && texText && texText.data) {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../../index.html" class="navbar-brand navbar-brand-logo">
    </a>
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Daianna Gonzalez-Padilla</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">About me</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../blog.html"> 
<span class="menu-text">Blog</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://daianna21.github.io"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="http://www.linkedin.com/in/daianna-glez"> <i class="bi bi-linkedin" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://x.com/daianna_glez/"> <i class="bi bi-twitter" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="mailto:glezdaianna@gmail.com"> <i class="bi bi-envelope-at" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="../../blog.xml"> <i class="bi bi-rss" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#what-youll-learn-here" id="toc-what-youll-learn-here" class="nav-link" data-scroll-target="#what-youll-learn-here">What you‚Äôll learn here</a></li>
  <li><a href="#defining-the-p-value" id="toc-defining-the-p-value" class="nav-link" data-scroll-target="#defining-the-p-value">Defining the <em>p</em>-value</a></li>
  <li><a href="#the-flatness-of-the-p-value-histogram" id="toc-the-flatness-of-the-p-value-histogram" class="nav-link" data-scroll-target="#the-flatness-of-the-p-value-histogram">The flatness ü•ø of the <em>p</em>-value histogram</a>
  <ul class="collapse">
  <li><a href="#left-tailed-p-values" id="toc-left-tailed-p-values" class="nav-link" data-scroll-target="#left-tailed-p-values">Left-tailed <em>p</em>-values</a>
  <ul class="collapse">
  <li><a href="#mathematical-demonstration" id="toc-mathematical-demonstration" class="nav-link" data-scroll-target="#mathematical-demonstration">Mathematical demonstration</a></li>
  </ul></li>
  <li><a href="#right-tailed-p-values" id="toc-right-tailed-p-values" class="nav-link" data-scroll-target="#right-tailed-p-values">Right-tailed <em>p</em>-values</a>
  <ul class="collapse">
  <li><a href="#mathematical-demonstration-1" id="toc-mathematical-demonstration-1" class="nav-link" data-scroll-target="#mathematical-demonstration-1">Mathematical demonstration</a></li>
  </ul></li>
  <li><a href="#two-tailed-p-values" id="toc-two-tailed-p-values" class="nav-link" data-scroll-target="#two-tailed-p-values">Two-tailed <em>p</em>-values</a>
  <ul class="collapse">
  <li><a href="#mathematical-demonstration-2" id="toc-mathematical-demonstration-2" class="nav-link" data-scroll-target="#mathematical-demonstration-2">Mathematical demonstration</a></li>
  <li><a href="#when-p-values-are-uniformly-distributed" id="toc-when-p-values-are-uniformly-distributed" class="nav-link" data-scroll-target="#when-p-values-are-uniformly-distributed"><strong>When p-values&nbsp;<em>are</em>&nbsp;uniformly distributed</strong></a></li>
  <li><a href="#when-they-are-not-uniformly-distributed" id="toc-when-they-are-not-uniformly-distributed" class="nav-link" data-scroll-target="#when-they-are-not-uniformly-distributed"><strong>When they are&nbsp;<em>not</em>&nbsp;uniformly distributed</strong></a></li>
  </ul></li>
  </ul></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion">Conclusion</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Why are <em>p</em>-values uniformly distributed?</h1>
  <div class="quarto-categories">
    <div class="quarto-category">p-value</div>
    <div class="quarto-category">test statistic</div>
    <div class="quarto-category">cumulative distribution function</div>
    <div class="quarto-category">uniform distribution</div>
    <div class="quarto-category">probability integral transform</div>
  </div>
  </div>

<div>
  <div class="description">
    <p>Graphical illustration and mathematical proof of the uniform distribution of <em>p</em>-values</p>
  </div>
</div>


<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Daianna Gonzalez-Padilla </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">February 7, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<p>‚ö†Ô∏è This page is under development.</p>
<section id="introduction" class="level1">
<h1>Introduction</h1>
<p>If you‚Äôve ever tested a null hypothesis multiple times and computed a <em>p</em>-value for each test, you‚Äôve almost certainly heard:</p>
<blockquote class="blockquote">
<p>‚ÄúUnder the null hypothesis, <em>p</em>-values are uniformly distributed.‚Äù</p>
</blockquote>
<p>In the practice, this statement is easy to graphically verify‚Äîsimply plot the histogram of the <em>p</em>-values and examine the flatness of the distribution; any deviation toward the left (<em>p</em>-values closer to 0) suggests some tests don‚Äôt follow the null hypothesis. However, the reason why <em>p</em>-values spread evenly between 0 and 1 isn‚Äôt immediately apparent.</p>
<p><strong>The uniformity of <em>p</em>-values is a direct consequence of how they‚Äôre defined and a theorem from probability theory called the <em>probability integral transform</em></strong>. In this post, we‚Äôll unpack exactly why <em>p</em>-values follow an uniform distribution, both graphically and mathematically.</p>
</section>
<section id="what-youll-learn-here" class="level1">
<h1>What you‚Äôll learn here</h1>
<ul>
<li><p>Understand how <em>p</em>-values are derived and how they relate to quantiles of a distribution.</p></li>
<li><p>Graphically demonstrate how p-values build an uniform distribution, when taking the lower and upper tails.</p></li>
<li><p>Mathematically demonstrate the uniformity of p-values according to xx theorem.</p></li>
</ul>
</section>
<section id="defining-the-p-value" class="level1">
<h1>Defining the <em>p</em>-value</h1>
<p>Let us begin by defining a test statistic. When you conduct a hypothesis test on a sample or dataset, you compute a quantity that measures the <em>effect</em> you are interested in (e.g.&nbsp;the difference in sample means across conditions). This effect estimate is often accompanied by a measure of <em>uncertainty</em> that depends on sample size and variability. In many statistical tests, the effect and its uncertainty are combined into what is known as a <span style="color:#EE7942"><strong>test statistic</strong></span>, but its specific construction depends on the properties of the data and the research question.</p>
<p>What is key about test statistics is that we know (or can approximate) their sampling distribution under the <em>null hypothesis</em> (e.g.&nbsp;when the effect is nonexistent). This allow us to compare our observed test statistic <span class="math inline">\(t_{ob}\)</span> against the null distribution and assess how likely such a value would be if the null hypothesis were true. If you followed this reasoning, you‚Äôve essentially grasped what a <em>p</em>-value is.</p>
<p>The <span style="color:#EE0000"><strong><em>p</em>-value</strong></span> is the probability that, if you were to draw at random from such null distribution of test statistics, you would get one that is equal or more extreme (smaller or greater) than your observed test statistic <span style="background-color:#F0FBC5"><span class="math inline">\(t_{ob}\)</span></span>.</p>
<p>To visualize what a <em>p</em>-value represents, let‚Äôs simulate a null distribution of test statistics by randomly sampling 10,000 times from a standard normal distribution. Let <span class="math inline">\(T\)</span> denote the test statistic, a random variable induced by the data, whose distribution under the null hypothesis we are simulating.</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(latex2exp)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="do">## Generate null distribution from N(0,1) </span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">08112025</span>)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>null <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">10000</span>, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">1</span>)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="do">## Density plot </span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>density <span class="ot">&lt;-</span> <span class="fu">dnorm</span>(null, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">1</span>) </span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">t =</span> null, <span class="at">y =</span> density)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> df, <span class="fu">aes</span>(<span class="at">x =</span> t, <span class="at">ymin =</span> <span class="dv">0</span>, <span class="at">ymax =</span> y)) <span class="sc">+</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="at">fill =</span> <span class="st">"gray95"</span>, <span class="at">linewidth =</span> <span class="fl">0.4</span>) <span class="sc">+</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Test statistic (T)"</span>, </span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Density"</span>) <span class="sc">+</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> y)) <span class="sc">+</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fu">max</span>(df<span class="sc">$</span>y)<span class="sc">+</span><span class="fl">0.02</span>), <span class="at">expand =</span> F) <span class="sc">+</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">9</span>, <span class="at">color =</span> <span class="st">"gray30"</span>), </span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">9</span>),</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="index_files/figure-html/simulate_null_dist-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="460"></p>
</figure>
</div>
</div>
</div>
<p>For a <strong>left-tailed</strong> test, the <em>p</em>-value corresponding to the observed test statistic <span class="math inline">\(t_{ob}\)</span> is given by <span class="math inline">\(p_{_{left}}(t_{ob}) = P(T \leq t_{ob})\)</span>, i.e., the cumulative distribution function (CDF) of <span class="math inline">\(T\)</span> evaluated at <span class="math inline">\(t_{ob}\)</span>, under the null hypothesis.</p>
<div class="cell">
<details class="code-fold">
<summary>Show function for plotting p-value</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>plot_density_and_pval <span class="ot">&lt;-</span> <span class="cf">function</span>(t_ob, tail){</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(tail <span class="sc">==</span> <span class="st">"left"</span>) {</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    df<span class="sc">$</span>to_fill <span class="ot">&lt;-</span> <span class="fu">as.character</span>(df<span class="sc">$</span>t <span class="sc">&lt;=</span> t_ob)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    pval <span class="ot">&lt;-</span> <span class="fu">signif</span>(<span class="fu">pnorm</span>(t_ob, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">1</span>, <span class="at">lower.tail =</span> T), <span class="at">digits =</span> <span class="dv">2</span>)</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>    fill_lab <span class="ot">=</span> <span class="fu">expression</span>(T <span class="sc">&lt;=</span> t[ob])</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>    p_lab_x_pos <span class="ot">=</span> <span class="fu">min</span>(df<span class="sc">$</span>t) <span class="sc">+</span> <span class="fl">1.2</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span>(tail <span class="sc">==</span> <span class="st">"right"</span>) {</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>    df<span class="sc">$</span>to_fill <span class="ot">&lt;-</span> <span class="fu">as.character</span>(df<span class="sc">$</span>t <span class="sc">&gt;</span> t_ob)</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>    pval <span class="ot">&lt;-</span> <span class="fu">signif</span>(<span class="fu">pnorm</span>(t_ob, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">1</span>, <span class="at">lower.tail =</span> F), <span class="at">digits =</span> <span class="dv">2</span>)</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>    fill_lab <span class="ot">=</span> <span class="fu">expression</span>(T <span class="sc">&gt;</span> t[ob])</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>    p_lab_x_pos <span class="ot">=</span> <span class="sc">-</span>(<span class="fu">min</span>(df<span class="sc">$</span>t) <span class="sc">+</span> <span class="fl">1.2</span>)</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Two-tailed test</span></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>    p_lab_x_pos <span class="ot">=</span> <span class="dv">0</span></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">sum</span>(df<span class="sc">$</span>t <span class="sc">&lt;=</span> t_ob) <span class="sc">&lt;</span> <span class="fu">sum</span>(df<span class="sc">$</span>t <span class="sc">&gt;</span> t_ob)){</span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>      t_right_tail <span class="ot">&lt;-</span> <span class="fu">quantile</span>(df<span class="sc">$</span>t, <span class="dv">1</span><span class="sc">-</span><span class="fu">sum</span>(df<span class="sc">$</span>t <span class="sc">&lt;=</span> t_ob)<span class="sc">/</span><span class="fu">length</span>(df<span class="sc">$</span>t))</span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>      df<span class="sc">$</span>to_fill <span class="ot">&lt;-</span> <span class="fu">as.character</span>(df<span class="sc">$</span>t <span class="sc">&lt;=</span> t_ob <span class="sc">|</span> df<span class="sc">$</span>t <span class="sc">&gt;=</span> t_right_tail)</span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>      pval <span class="ot">&lt;-</span> <span class="fu">signif</span>(<span class="dv">2</span><span class="sc">*</span><span class="fu">pnorm</span>(t_ob, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">1</span>, <span class="at">lower.tail =</span> T), <span class="at">digits =</span> <span class="dv">2</span>)</span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>      fill_lab <span class="ot">=</span> <span class="fu">expression</span>(T <span class="sc">&lt;=</span> t[ob] <span class="sc">~</span> <span class="st">"|"</span> <span class="sc">~</span> T <span class="sc">&gt;=</span> <span class="sc">-</span>t[ob])</span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>      t_left_tail <span class="ot">&lt;-</span> <span class="fu">quantile</span>(df<span class="sc">$</span>t, <span class="fu">sum</span>(df<span class="sc">$</span>t <span class="sc">&gt;</span> t_ob)<span class="sc">/</span><span class="fu">length</span>(df<span class="sc">$</span>t))</span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a>      df<span class="sc">$</span>to_fill <span class="ot">&lt;-</span> <span class="fu">as.character</span>(df<span class="sc">$</span>t <span class="sc">&gt;</span> t_ob <span class="sc">|</span> df<span class="sc">$</span>t <span class="sc">&lt;=</span> t_left_tail)</span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a>      pval <span class="ot">&lt;-</span> <span class="fu">signif</span>(<span class="dv">2</span><span class="sc">*</span><span class="fu">pnorm</span>(t_ob, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">1</span>, <span class="at">lower.tail =</span> F), <span class="at">digits =</span> <span class="dv">2</span>)</span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a>      fill_lab <span class="ot">=</span> <span class="fu">expression</span>(T <span class="sc">&gt;</span> t[ob] <span class="sc">~</span> <span class="st">"|"</span> <span class="sc">~</span> T <span class="sc">&lt;</span> <span class="sc">-</span>t[ob])</span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a>  df<span class="sc">$</span>to_fill <span class="ot">&lt;-</span> <span class="fu">factor</span>(df<span class="sc">$</span>to_fill, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"TRUE"</span>, <span class="st">"FALSE"</span>))</span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> df, <span class="fu">aes</span>(<span class="at">x =</span> t, <span class="at">ymin =</span> <span class="dv">0</span>, <span class="at">ymax =</span> y,</span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a>                      <span class="at">fill =</span> to_fill)) <span class="sc">+</span></span>
<span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="at">linewidth =</span> <span class="fl">0.4</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb2-44"><a href="#cb2-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"TRUE"</span> <span class="ot">=</span> <span class="st">"orangered1"</span>, <span class="st">"FALSE"</span> <span class="ot">=</span> <span class="st">"gray95"</span>)) <span class="sc">+</span></span>
<span id="cb2-45"><a href="#cb2-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> t_ob, <span class="at">xend =</span> t_ob, </span>
<span id="cb2-46"><a href="#cb2-46" aria-hidden="true" tabindex="-1"></a>                   <span class="at">y =</span> <span class="dv">0</span>, <span class="at">yend =</span> df[df<span class="sc">$</span>t <span class="sc">==</span> t_ob, <span class="st">"y"</span>]),</span>
<span id="cb2-47"><a href="#cb2-47" aria-hidden="true" tabindex="-1"></a>               <span class="at">linewidth =</span> <span class="fl">0.25</span>, <span class="at">show.legend =</span> F) <span class="sc">+</span></span>
<span id="cb2-48"><a href="#cb2-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">x =</span> p_lab_x_pos, <span class="at">y =</span> df[df<span class="sc">$</span>t <span class="sc">==</span> t_ob, <span class="st">"y"</span>]<span class="sc">/</span><span class="dv">2</span>), </span>
<span id="cb2-49"><a href="#cb2-49" aria-hidden="true" tabindex="-1"></a>            <span class="at">inherit.aes =</span> T, </span>
<span id="cb2-50"><a href="#cb2-50" aria-hidden="true" tabindex="-1"></a>            <span class="at">label =</span> <span class="fu">paste0</span>(<span class="st">"italic(p) == "</span>, pval),</span>
<span id="cb2-51"><a href="#cb2-51" aria-hidden="true" tabindex="-1"></a>            <span class="at">fontface =</span> <span class="st">"plain"</span>, <span class="at">lineheight =</span> <span class="fl">0.8</span>,</span>
<span id="cb2-52"><a href="#cb2-52" aria-hidden="true" tabindex="-1"></a>            <span class="at">size =</span> <span class="fl">2.5</span>, <span class="at">show.legend =</span> F, <span class="at">parse =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb2-53"><a href="#cb2-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb2-54"><a href="#cb2-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"T"</span>, <span class="at">y =</span> <span class="st">"Density"</span>,</span>
<span id="cb2-55"><a href="#cb2-55" aria-hidden="true" tabindex="-1"></a>       <span class="at">fill =</span> fill_lab) <span class="sc">+</span></span>
<span id="cb2-56"><a href="#cb2-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fu">max</span>(df<span class="sc">$</span>y)), <span class="at">expand =</span> F) <span class="sc">+</span></span>
<span id="cb2-57"><a href="#cb2-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"rect"</span>, <span class="at">xmin =</span> t_ob <span class="sc">-</span> <span class="fl">0.25</span>, <span class="at">xmax =</span> t_ob <span class="sc">+</span> <span class="fl">0.25</span>,</span>
<span id="cb2-58"><a href="#cb2-58" aria-hidden="true" tabindex="-1"></a>           <span class="at">ymin =</span> <span class="fl">0.022</span> <span class="sc">-</span> <span class="fl">0.015</span>, <span class="at">ymax =</span> <span class="fl">0.022</span> <span class="sc">+</span> <span class="fl">0.015</span>,</span>
<span id="cb2-59"><a href="#cb2-59" aria-hidden="true" tabindex="-1"></a>           <span class="at">fill =</span> <span class="st">"#F0FBC5"</span>, <span class="at">alpha =</span> <span class="fl">0.85</span>) <span class="sc">+</span></span>
<span id="cb2-60"><a href="#cb2-60" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">x =</span> t_ob, <span class="at">y =</span> <span class="fl">0.022</span>, <span class="at">label =</span>  <span class="fu">expression</span>(t[ob])), </span>
<span id="cb2-61"><a href="#cb2-61" aria-hidden="true" tabindex="-1"></a>                 <span class="at">parse =</span> T, <span class="at">size =</span> <span class="fl">3.3</span>, <span class="at">show.legend =</span> F) <span class="sc">+</span></span>
<span id="cb2-62"><a href="#cb2-62" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">9</span>),</span>
<span id="cb2-63"><a href="#cb2-63" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb2-64"><a href="#cb2-64" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb2-65"><a href="#cb2-65" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">7</span>),</span>
<span id="cb2-66"><a href="#cb2-66" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb2-67"><a href="#cb2-67" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.key.height =</span> <span class="fu">unit</span>(<span class="fl">0.5</span>, <span class="st">"cm"</span>),</span>
<span id="cb2-68"><a href="#cb2-68" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.key.width =</span> <span class="fu">unit</span>(<span class="fl">0.5</span>, <span class="st">"cm"</span>))</span>
<span id="cb2-69"><a href="#cb2-69" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-70"><a href="#cb2-70" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(tail <span class="sc">==</span> <span class="st">"both"</span>){</span>
<span id="cb2-71"><a href="#cb2-71" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">sum</span>(df<span class="sc">$</span>t <span class="sc">&lt;=</span> t_ob) <span class="sc">&lt;</span> <span class="fu">sum</span>(df<span class="sc">$</span>t <span class="sc">&gt;</span> t_ob)){</span>
<span id="cb2-72"><a href="#cb2-72" aria-hidden="true" tabindex="-1"></a>      tail_line <span class="ot">&lt;-</span> t_right_tail</span>
<span id="cb2-73"><a href="#cb2-73" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span>{</span>
<span id="cb2-74"><a href="#cb2-74" aria-hidden="true" tabindex="-1"></a>      tail_line <span class="ot">&lt;-</span> t_left_tail</span>
<span id="cb2-75"><a href="#cb2-75" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb2-76"><a href="#cb2-76" aria-hidden="true" tabindex="-1"></a>    p <span class="ot">=</span> p <span class="sc">+</span> <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> tail_line, <span class="at">xend =</span> tail_line, </span>
<span id="cb2-77"><a href="#cb2-77" aria-hidden="true" tabindex="-1"></a>                               <span class="at">y =</span> <span class="dv">0</span>, <span class="at">yend =</span> <span class="fu">dnorm</span>(tail_line, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">1</span>)),</span>
<span id="cb2-78"><a href="#cb2-78" aria-hidden="true" tabindex="-1"></a>                          <span class="at">linewidth =</span> <span class="fl">0.25</span>, <span class="at">show.legend =</span> F) <span class="sc">+</span></span>
<span id="cb2-79"><a href="#cb2-79" aria-hidden="true" tabindex="-1"></a>      <span class="fu">annotate</span>(<span class="st">"rect"</span>, <span class="at">xmin =</span> (<span class="sc">-</span>t_ob) <span class="sc">-</span> <span class="fl">0.25</span>, <span class="at">xmax =</span> (<span class="sc">-</span>t_ob) <span class="sc">+</span> <span class="fl">0.3</span>,</span>
<span id="cb2-80"><a href="#cb2-80" aria-hidden="true" tabindex="-1"></a>           <span class="at">ymin =</span> <span class="fl">0.022</span> <span class="sc">-</span> <span class="fl">0.015</span>, <span class="at">ymax =</span> <span class="fl">0.022</span> <span class="sc">+</span> <span class="fl">0.015</span>,</span>
<span id="cb2-81"><a href="#cb2-81" aria-hidden="true" tabindex="-1"></a>           <span class="at">fill =</span> <span class="st">"#F0FBC5"</span>, <span class="at">alpha =</span> <span class="fl">0.85</span>) <span class="sc">+</span></span>
<span id="cb2-82"><a href="#cb2-82" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">x =</span> (<span class="sc">-</span>t_ob), <span class="at">y =</span> <span class="fl">0.022</span>, <span class="at">label =</span>  <span class="fu">expression</span>(<span class="sc">-</span>t[ob])), </span>
<span id="cb2-83"><a href="#cb2-83" aria-hidden="true" tabindex="-1"></a>                 <span class="at">parse =</span> T, <span class="at">size =</span> <span class="fl">3.3</span>, <span class="at">show.legend =</span> F)</span>
<span id="cb2-84"><a href="#cb2-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-85"><a href="#cb2-85" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb2-86"><a href="#cb2-86" aria-hidden="true" tabindex="-1"></a>  p</span>
<span id="cb2-87"><a href="#cb2-87" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_density_and_pval</span>(<span class="at">t_ob =</span> df<span class="sc">$</span>t[<span class="dv">2</span>], <span class="at">tail =</span> <span class="st">"left"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="index_files/figure-html/left_tailed_pval-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="537"></p>
</figure>
</div>
</div>
</div>
<p>For a <strong>right-tailed</strong> test the <em>p</em>-value for <span class="math inline">\(t_{ob}\)</span> is given by <span class="math inline">\(p_{_{right}}(t_{ob}) = P(T &gt;t_{ob}) = 1 - P(T \leq t_{ob})\)</span>, under the null hypothesis.</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_density_and_pval</span>(<span class="at">t_ob =</span> df<span class="sc">$</span>t[<span class="dv">2</span>], <span class="at">tail =</span> <span class="st">"right"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="index_files/figure-html/right_tailed_pval-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="537"></p>
</figure>
</div>
</div>
</div>
<p>For a <strong>two-tailed</strong> test the <em>p</em>-value for <span class="math inline">\(t_{ob}\)</span> is twice the smallest tail probability, i.e., <span class="math inline">\(p_{_{two}}(t_{ob}) =  2 \times min\{p_{_{left}}(t_{ob}),\ \ p_{_{right}}(t_{ob})\} =2 \times min\{P(T \leq t_{ob}),\ \ P(T &gt;t_{ob})\}\)</span> (if the null distribution is symmetric ‚ö†Ô∏è).</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_density_and_pval</span>(<span class="at">t_ob =</span> df<span class="sc">$</span>t[<span class="dv">2</span>], <span class="at">tail =</span> <span class="st">"both"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="index_files/figure-html/two_tailed_pval-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="537"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="the-flatness-of-the-p-value-histogram" class="level1">
<h1>The flatness ü•ø of the <em>p</em>-value histogram</h1>
<section id="left-tailed-p-values" class="level2">
<h2 class="anchored" data-anchor-id="left-tailed-p-values">Left-tailed <em>p</em>-values</h2>
<p>To visualize why <em>p</em>-values are uniformly distributed, let‚Äôs consider all test statistics in the null distribution that fall below or at the 1st decile (<span class="math inline">\(t_{_{10\%}}\)</span>)‚Äîthat is, the bottom 10%.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Although deciles are used here for simplicity, the same reasoning applies to any proportion of the data.</p>
</div>
</div>
<p>For this purpose, we build three functions. The first annotates each test statistic <span class="math inline">\(t\)</span> with the decile interval it falls into in the simulated null distribution; the second plots the density of <span class="math inline">\(T\)</span> showing selected decile intervals, and the third plots the histogram of <em>p</em>-values for all test statistics contained in such intervals.</p>
<div class="cell">
<details class="code-fold">
<summary>Show functions</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(grid)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="do">## 1. Function to annotate decile interval for each test statistic t</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>annotate_decile_range <span class="ot">&lt;-</span> <span class="cf">function</span>(decile){</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  q <span class="ot">=</span> decile</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>  <span class="do">## First annotate if each t is &lt;= decile q</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>  decile_range <span class="ot">&lt;-</span> <span class="fu">if_else</span>(df<span class="sc">$</span>t <span class="sc">&lt;=</span> <span class="fu">quantile</span>(df<span class="sc">$</span>t, q), <span class="fu">paste</span>(<span class="st">"leq"</span>, q), <span class="fu">paste</span>(<span class="st">"g"</span>, q))</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>  <span class="cf">while</span>(q <span class="sc">&gt;</span> <span class="fl">0.1</span>){</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>    <span class="do">## Then annotate if each t is between decile q-1 and q</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>    decile_range[<span class="fu">which</span>(df<span class="sc">$</span>t <span class="sc">&gt;</span> <span class="fu">quantile</span>(df<span class="sc">$</span>t, q<span class="fl">-0.1</span>) <span class="sc">&amp;</span> </span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>                         df<span class="sc">$</span>t <span class="sc">&lt;=</span> <span class="fu">quantile</span>(df<span class="sc">$</span>t, q))] <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"g"</span>, q<span class="fl">-0.1</span>, <span class="st">", leq"</span>, q)</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>    q <span class="ot">=</span> q <span class="sc">-</span> <span class="fl">0.1</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>  decile_range[<span class="fu">which</span>(df<span class="sc">$</span>t <span class="sc">&lt;=</span> <span class="fu">quantile</span>(df<span class="sc">$</span>t, <span class="fl">0.1</span>))] <span class="ot">&lt;-</span> <span class="st">"leq 0.1"</span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>  df<span class="sc">$</span>decile_range <span class="ot">&lt;-</span> decile_range</span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(df)</span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a><span class="do">## 2. Function to color decile intervals in T density up to decile q</span></span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>plot_density_decile <span class="ot">&lt;-</span> <span class="cf">function</span>(decile){</span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> <span class="fu">annotate_decile_range</span>(decile)</span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Colors and alphas for decile ranges</span></span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a>  range_colors <span class="ot">=</span> <span class="fu">c</span>(<span class="fu">colorRampPalette</span>(<span class="fu">c</span>(<span class="st">"honeydew1"</span>, <span class="st">"azure2"</span>, <span class="st">"thistle2"</span>,<span class="st">"plum"</span>,</span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">"sienna2"</span>))(<span class="dv">10</span>), <span class="st">"gray90"</span>)</span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a>  range_alphas <span class="ot">=</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="dv">1</span>, <span class="dv">10</span>), <span class="fl">0.2</span>)</span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(range_colors) <span class="ot">&lt;-</span> <span class="fu">names</span>(range_alphas) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"leq 0.1"</span>, </span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a>                                   <span class="fu">paste</span>(<span class="st">"g"</span>, <span class="fu">seq</span>(<span class="at">from =</span> <span class="fl">0.1</span>, <span class="at">to =</span> <span class="fl">0.9</span>, <span class="at">by =</span> <span class="fl">0.1</span>), <span class="st">","</span>, <span class="st">"leq"</span>, </span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a>                                         <span class="fu">seq</span>(<span class="at">from =</span> <span class="fl">0.1</span>, <span class="at">to =</span> <span class="fl">0.9</span>, <span class="at">by =</span> <span class="fl">0.1</span>) <span class="sc">+</span> <span class="fl">0.1</span>), </span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a>                                   <span class="fu">paste</span>(<span class="st">"g"</span>, decile))</span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-38"><a href="#cb6-38" aria-hidden="true" tabindex="-1"></a>  vlines <span class="ot">&lt;-</span> <span class="fu">vector</span>()</span>
<span id="cb6-39"><a href="#cb6-39" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(q <span class="cf">in</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="fl">0.1</span>, <span class="at">to =</span> decile, <span class="at">by =</span> <span class="fl">0.1</span>)){</span>
<span id="cb6-40"><a href="#cb6-40" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-41"><a href="#cb6-41" aria-hidden="true" tabindex="-1"></a>    <span class="do">## For vertical lines in each decile </span></span>
<span id="cb6-42"><a href="#cb6-42" aria-hidden="true" tabindex="-1"></a>    x <span class="ot">=</span> <span class="fu">quantile</span>(df<span class="sc">$</span>t, q)</span>
<span id="cb6-43"><a href="#cb6-43" aria-hidden="true" tabindex="-1"></a>    xend <span class="ot">=</span> <span class="fu">quantile</span>(df<span class="sc">$</span>t, q)</span>
<span id="cb6-44"><a href="#cb6-44" aria-hidden="true" tabindex="-1"></a>    y <span class="ot">=</span> <span class="dv">0</span></span>
<span id="cb6-45"><a href="#cb6-45" aria-hidden="true" tabindex="-1"></a>    yend <span class="ot">=</span> df[<span class="fu">which.min</span>(<span class="fu">abs</span>(df<span class="sc">$</span>t <span class="sc">-</span> x)), <span class="st">"y"</span>]</span>
<span id="cb6-46"><a href="#cb6-46" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-47"><a href="#cb6-47" aria-hidden="true" tabindex="-1"></a>    <span class="do">## For annotating "10%" above each decile interval</span></span>
<span id="cb6-48"><a href="#cb6-48" aria-hidden="true" tabindex="-1"></a>    prior_x <span class="ot">=</span> <span class="fu">quantile</span>(df<span class="sc">$</span>t, q<span class="fl">-0.1</span>)</span>
<span id="cb6-49"><a href="#cb6-49" aria-hidden="true" tabindex="-1"></a>    prior_yend <span class="ot">=</span> df[<span class="fu">which.min</span>(<span class="fu">abs</span>(df<span class="sc">$</span>t <span class="sc">-</span> prior_x)), <span class="st">"y"</span>]</span>
<span id="cb6-50"><a href="#cb6-50" aria-hidden="true" tabindex="-1"></a>    middle_x <span class="ot">=</span> prior_x <span class="sc">+</span> (x <span class="sc">-</span> prior_x)<span class="sc">/</span><span class="dv">2</span></span>
<span id="cb6-51"><a href="#cb6-51" aria-hidden="true" tabindex="-1"></a>    middle_y <span class="ot">=</span> prior_yend <span class="sc">+</span> (yend <span class="sc">-</span> prior_yend)<span class="sc">/</span><span class="dv">2</span></span>
<span id="cb6-52"><a href="#cb6-52" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb6-53"><a href="#cb6-53" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(q <span class="sc">==</span> <span class="fl">0.1</span>){</span>
<span id="cb6-54"><a href="#cb6-54" aria-hidden="true" tabindex="-1"></a>      lab_x_pos <span class="ot">=</span> middle_x</span>
<span id="cb6-55"><a href="#cb6-55" aria-hidden="true" tabindex="-1"></a>      lab_y_pos <span class="ot">=</span> middle_y <span class="sc">-</span> <span class="fl">0.04</span></span>
<span id="cb6-56"><a href="#cb6-56" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb6-57"><a href="#cb6-57" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> <span class="cf">if</span>(q <span class="sc">==</span> <span class="dv">1</span>){</span>
<span id="cb6-58"><a href="#cb6-58" aria-hidden="true" tabindex="-1"></a>      lab_x_pos <span class="ot">=</span> middle_x</span>
<span id="cb6-59"><a href="#cb6-59" aria-hidden="true" tabindex="-1"></a>      lab_y_pos <span class="ot">=</span> middle_y <span class="sc">-</span> <span class="fl">0.03</span></span>
<span id="cb6-60"><a href="#cb6-60" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb6-61"><a href="#cb6-61" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> <span class="cf">if</span>(q <span class="sc">==</span> <span class="fl">0.5</span>){</span>
<span id="cb6-62"><a href="#cb6-62" aria-hidden="true" tabindex="-1"></a>      lab_x_pos <span class="ot">=</span> middle_x <span class="sc">-</span> <span class="fl">0.05</span></span>
<span id="cb6-63"><a href="#cb6-63" aria-hidden="true" tabindex="-1"></a>      lab_y_pos <span class="ot">=</span> middle_y <span class="sc">+</span> <span class="fl">0.014</span></span>
<span id="cb6-64"><a href="#cb6-64" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb6-65"><a href="#cb6-65" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> <span class="cf">if</span>(q <span class="sc">==</span> <span class="fl">0.6</span>){</span>
<span id="cb6-66"><a href="#cb6-66" aria-hidden="true" tabindex="-1"></a>      lab_x_pos <span class="ot">=</span> middle_x <span class="sc">+</span> <span class="fl">0.12</span></span>
<span id="cb6-67"><a href="#cb6-67" aria-hidden="true" tabindex="-1"></a>      lab_y_pos <span class="ot">=</span> middle_y <span class="sc">+</span> <span class="fl">0.014</span></span>
<span id="cb6-68"><a href="#cb6-68" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb6-69"><a href="#cb6-69" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>{</span>
<span id="cb6-70"><a href="#cb6-70" aria-hidden="true" tabindex="-1"></a>      lab_x_pos <span class="ot">=</span> middle_x <span class="sc">+</span> (<span class="fu">sign</span>(x)<span class="sc">*</span><span class="fl">0.17</span>)</span>
<span id="cb6-71"><a href="#cb6-71" aria-hidden="true" tabindex="-1"></a>      diff_y <span class="ot">=</span> <span class="fu">abs</span>((yend <span class="sc">-</span> prior_yend)<span class="sc">/</span><span class="dv">2</span>)</span>
<span id="cb6-72"><a href="#cb6-72" aria-hidden="true" tabindex="-1"></a>      lab_y_pos <span class="ot">=</span> middle_y <span class="sc">+</span> (diff_y<span class="sc">*</span><span class="fl">0.33</span>)</span>
<span id="cb6-73"><a href="#cb6-73" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb6-74"><a href="#cb6-74" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-75"><a href="#cb6-75" aria-hidden="true" tabindex="-1"></a>    vlines <span class="ot">&lt;-</span> <span class="fu">rbind</span>(vlines, <span class="fu">c</span>(q, x, xend, y, yend, lab_x_pos, lab_y_pos))</span>
<span id="cb6-76"><a href="#cb6-76" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb6-77"><a href="#cb6-77" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-78"><a href="#cb6-78" aria-hidden="true" tabindex="-1"></a>  vlines <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(vlines)</span>
<span id="cb6-79"><a href="#cb6-79" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(vlines) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"decile"</span>, <span class="st">"x"</span>, <span class="st">"xend"</span>, <span class="st">"y"</span>, <span class="st">"yend"</span>, <span class="st">"lab_x_pos"</span>, <span class="st">"lab_y_pos"</span>)</span>
<span id="cb6-80"><a href="#cb6-80" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-81"><a href="#cb6-81" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-82"><a href="#cb6-82" aria-hidden="true" tabindex="-1"></a>  plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> df, <span class="fu">aes</span>(<span class="at">x =</span> t, <span class="at">ymin =</span> <span class="dv">0</span>, <span class="at">ymax =</span> y, </span>
<span id="cb6-83"><a href="#cb6-83" aria-hidden="true" tabindex="-1"></a>                        <span class="at">fill =</span> decile_range,</span>
<span id="cb6-84"><a href="#cb6-84" aria-hidden="true" tabindex="-1"></a>                        <span class="at">alpha =</span> decile_range)) <span class="sc">+</span></span>
<span id="cb6-85"><a href="#cb6-85" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">linewidth =</span> <span class="fl">0.35</span>) <span class="sc">+</span></span>
<span id="cb6-86"><a href="#cb6-86" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb6-87"><a href="#cb6-87" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> range_colors) <span class="sc">+</span></span>
<span id="cb6-88"><a href="#cb6-88" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_alpha_manual</span>(<span class="at">values =</span> range_alphas) <span class="sc">+</span></span>
<span id="cb6-89"><a href="#cb6-89" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"T"</span>, </span>
<span id="cb6-90"><a href="#cb6-90" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Density"</span>) <span class="sc">+</span></span>
<span id="cb6-91"><a href="#cb6-91" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="at">data =</span> vlines, <span class="at">inherit.aes =</span> F,</span>
<span id="cb6-92"><a href="#cb6-92" aria-hidden="true" tabindex="-1"></a>               <span class="fu">aes</span>(<span class="at">x =</span> x <span class="sc">+</span> <span class="fl">0.005</span>, </span>
<span id="cb6-93"><a href="#cb6-93" aria-hidden="true" tabindex="-1"></a>                   <span class="at">xend =</span> xend <span class="sc">+</span> <span class="fl">0.005</span>,</span>
<span id="cb6-94"><a href="#cb6-94" aria-hidden="true" tabindex="-1"></a>                   <span class="at">y =</span> y, <span class="at">yend =</span> yend), </span>
<span id="cb6-95"><a href="#cb6-95" aria-hidden="true" tabindex="-1"></a>               <span class="at">linewidth =</span> <span class="fl">0.35</span>, <span class="at">show.legend =</span> F) <span class="sc">+</span></span>
<span id="cb6-96"><a href="#cb6-96" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">data =</span> vlines, <span class="at">inherit.aes =</span> F,</span>
<span id="cb6-97"><a href="#cb6-97" aria-hidden="true" tabindex="-1"></a>                <span class="fu">aes</span>(<span class="at">x =</span> lab_x_pos, <span class="at">y =</span> lab_y_pos), <span class="at">label =</span><span class="st">"10%"</span>, </span>
<span id="cb6-98"><a href="#cb6-98" aria-hidden="true" tabindex="-1"></a>            <span class="at">size =</span> <span class="fl">2.4</span>, <span class="at">show.legend =</span> F) <span class="sc">+</span></span>
<span id="cb6-99"><a href="#cb6-99" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">fill =</span> <span class="st">"none"</span>, <span class="at">alpha =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb6-100"><a href="#cb6-100" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fu">max</span>(df<span class="sc">$</span>y)<span class="sc">+</span><span class="fl">0.02</span>), <span class="at">expand =</span> F) <span class="sc">+</span></span>
<span id="cb6-101"><a href="#cb6-101" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">9</span>),</span>
<span id="cb6-102"><a href="#cb6-102" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">7</span>),</span>
<span id="cb6-103"><a href="#cb6-103" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span><span class="dv">8</span>),</span>
<span id="cb6-104"><a href="#cb6-104" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.key.height =</span> <span class="fu">unit</span>(<span class="fl">0.5</span>, <span class="st">"cm"</span>), </span>
<span id="cb6-105"><a href="#cb6-105" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.key.width =</span> <span class="fu">unit</span>(<span class="fl">0.5</span>, <span class="st">"cm"</span>),</span>
<span id="cb6-106"><a href="#cb6-106" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb6-107"><a href="#cb6-107" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>))</span>
<span id="cb6-108"><a href="#cb6-108" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-109"><a href="#cb6-109" aria-hidden="true" tabindex="-1"></a>  <span class="do">## To add labels for 1st and 2nd deciles</span></span>
<span id="cb6-110"><a href="#cb6-110" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(decile <span class="sc">==</span> <span class="fl">0.1</span>){</span>
<span id="cb6-111"><a href="#cb6-111" aria-hidden="true" tabindex="-1"></a>    plot <span class="ot">&lt;-</span> plot <span class="sc">+</span> <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">x =</span> vlines[<span class="dv">1</span>,<span class="st">"x"</span>], <span class="at">y =</span> <span class="fl">0.015</span>,</span>
<span id="cb6-112"><a href="#cb6-112" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">label =</span>  <span class="fu">expression</span>(t[<span class="st">"10%"</span>])), </span>
<span id="cb6-113"><a href="#cb6-113" aria-hidden="true" tabindex="-1"></a>                             <span class="at">inherit.aes =</span> F, <span class="at">parse =</span> T, <span class="at">size =</span> <span class="fl">3.3</span>)</span>
<span id="cb6-114"><a href="#cb6-114" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb6-115"><a href="#cb6-115" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span> <span class="cf">if</span>(decile <span class="sc">==</span> <span class="fl">0.2</span>){</span>
<span id="cb6-116"><a href="#cb6-116" aria-hidden="true" tabindex="-1"></a>    plot <span class="ot">&lt;-</span> plot <span class="sc">+</span> <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">x =</span> vlines[<span class="dv">1</span>,<span class="st">"x"</span>]<span class="sc">-</span><span class="fl">0.07</span>, <span class="at">y =</span> <span class="fl">0.015</span>,</span>
<span id="cb6-117"><a href="#cb6-117" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">label =</span>  <span class="fu">expression</span>(t[<span class="st">"10%"</span>])), </span>
<span id="cb6-118"><a href="#cb6-118" aria-hidden="true" tabindex="-1"></a>                             <span class="at">inherit.aes =</span> F, <span class="at">parse =</span> T, <span class="at">size =</span> <span class="fl">3.4</span>) <span class="sc">+</span> </span>
<span id="cb6-119"><a href="#cb6-119" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">x =</span> vlines[<span class="dv">2</span>,<span class="st">"x"</span>]<span class="sc">+</span><span class="fl">0.07</span>, <span class="at">y =</span> <span class="fl">0.015</span>,</span>
<span id="cb6-120"><a href="#cb6-120" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">label =</span>  <span class="fu">expression</span>(t[<span class="st">"20%"</span>])), </span>
<span id="cb6-121"><a href="#cb6-121" aria-hidden="true" tabindex="-1"></a>                             <span class="at">inherit.aes =</span> F, <span class="at">parse =</span> T, <span class="at">size =</span> <span class="fl">3.4</span>)</span>
<span id="cb6-122"><a href="#cb6-122" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb6-123"><a href="#cb6-123" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-124"><a href="#cb6-124" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(plot)</span>
<span id="cb6-125"><a href="#cb6-125" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb6-126"><a href="#cb6-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-127"><a href="#cb6-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-128"><a href="#cb6-128" aria-hidden="true" tabindex="-1"></a><span class="do">## 3. Function to plot pval histogram up to decile q</span></span>
<span id="cb6-129"><a href="#cb6-129" aria-hidden="true" tabindex="-1"></a>plot_pval_hist <span class="ot">&lt;-</span> <span class="cf">function</span>(decile, tail){</span>
<span id="cb6-130"><a href="#cb6-130" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-131"><a href="#cb6-131" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(tail <span class="sc">==</span> <span class="st">"left"</span>){</span>
<span id="cb6-132"><a href="#cb6-132" aria-hidden="true" tabindex="-1"></a>    tail_pvals <span class="ot">&lt;-</span> <span class="st">"left_tailed_pval"</span></span>
<span id="cb6-133"><a href="#cb6-133" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span>(tail <span class="sc">==</span> <span class="st">"right"</span>){</span>
<span id="cb6-134"><a href="#cb6-134" aria-hidden="true" tabindex="-1"></a>    tail_pvals <span class="ot">&lt;-</span> <span class="st">"right_tailed_pval"</span></span>
<span id="cb6-135"><a href="#cb6-135" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span>{</span>
<span id="cb6-136"><a href="#cb6-136" aria-hidden="true" tabindex="-1"></a>    tail_pvals <span class="ot">&lt;-</span> <span class="st">"two_tailed_pval"</span></span>
<span id="cb6-137"><a href="#cb6-137" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb6-138"><a href="#cb6-138" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-139"><a href="#cb6-139" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Colors and alphas for decile ranges</span></span>
<span id="cb6-140"><a href="#cb6-140" aria-hidden="true" tabindex="-1"></a>  range_colors <span class="ot">=</span> <span class="fu">colorRampPalette</span>(<span class="fu">c</span>(<span class="st">"honeydew1"</span>, <span class="st">"azure2"</span>,<span class="st">"thistle2"</span>,<span class="st">"plum"</span>,</span>
<span id="cb6-141"><a href="#cb6-141" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">"sienna2"</span>))(<span class="dv">10</span>)</span>
<span id="cb6-142"><a href="#cb6-142" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(range_colors) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"leq 0.1"</span>, </span>
<span id="cb6-143"><a href="#cb6-143" aria-hidden="true" tabindex="-1"></a>                                   <span class="fu">paste</span>(<span class="st">"g"</span>, <span class="fu">seq</span>(<span class="at">from =</span> <span class="fl">0.1</span>, <span class="at">to =</span> <span class="fl">0.9</span>, <span class="at">by =</span> <span class="fl">0.1</span>), <span class="st">","</span>, <span class="st">"leq"</span>, </span>
<span id="cb6-144"><a href="#cb6-144" aria-hidden="true" tabindex="-1"></a>                                              <span class="fu">seq</span>(<span class="at">from =</span> <span class="fl">0.1</span>, <span class="at">to =</span> <span class="fl">0.9</span>, <span class="at">by =</span> <span class="fl">0.1</span>) <span class="sc">+</span> <span class="fl">0.1</span>))</span>
<span id="cb6-145"><a href="#cb6-145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-146"><a href="#cb6-146" aria-hidden="true" tabindex="-1"></a>  decile_ranges_labs <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"bottom 10%"</span>, <span class="st">"between 10-20%"</span>, <span class="st">"between 20-30%"</span>, <span class="st">"between 30-40%"</span>,</span>
<span id="cb6-147"><a href="#cb6-147" aria-hidden="true" tabindex="-1"></a>                          <span class="st">"between 40-50%"</span>, <span class="st">"between 50-60%"</span>, <span class="st">"between 60-70%"</span>,</span>
<span id="cb6-148"><a href="#cb6-148" aria-hidden="true" tabindex="-1"></a>                          <span class="st">"between 70-80%"</span>,<span class="st">"between 80-90%"</span>, <span class="st">"top 10%"</span>)</span>
<span id="cb6-149"><a href="#cb6-149" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(decile_ranges_labs) <span class="ot">&lt;-</span> <span class="fu">names</span>(range_colors)</span>
<span id="cb6-150"><a href="#cb6-150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-151"><a href="#cb6-151" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> <span class="fu">annotate_decile_range</span>(decile)</span>
<span id="cb6-152"><a href="#cb6-152" aria-hidden="true" tabindex="-1"></a>  decile_ranges <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(<span class="fu">unique</span>(df<span class="sc">$</span>decile_range), <span class="fu">paste</span>(<span class="st">"g"</span>, decile))</span>
<span id="cb6-153"><a href="#cb6-153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-154"><a href="#cb6-154" aria-hidden="true" tabindex="-1"></a>  data <span class="ot">=</span> <span class="fu">subset</span>(df, decile_range <span class="sc">%in%</span> decile_ranges)</span>
<span id="cb6-155"><a href="#cb6-155" aria-hidden="true" tabindex="-1"></a>  data<span class="sc">$</span>decile_range <span class="ot">&lt;-</span> <span class="fu">factor</span>(data<span class="sc">$</span>decile_range, <span class="at">levels =</span> <span class="fu">names</span>(decile_ranges_labs))</span>
<span id="cb6-156"><a href="#cb6-156" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-157"><a href="#cb6-157" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(tail <span class="sc">==</span> <span class="st">"both"</span>){</span>
<span id="cb6-158"><a href="#cb6-158" aria-hidden="true" tabindex="-1"></a>    data<span class="sc">$</span>decile_range <span class="ot">&lt;-</span> <span class="fu">factor</span>(data<span class="sc">$</span>decile_range, <span class="at">levels =</span> <span class="fu">rev</span>(<span class="fu">names</span>(decile_ranges_labs)))</span>
<span id="cb6-159"><a href="#cb6-159" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb6-160"><a href="#cb6-160" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-161"><a href="#cb6-161" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Histogram</span></span>
<span id="cb6-162"><a href="#cb6-162" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(data, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">get</span>(tail_pvals), <span class="at">fill =</span> decile_range)) <span class="sc">+</span></span>
<span id="cb6-163"><a href="#cb6-163" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">color=</span><span class="st">"black"</span>, <span class="at">bins =</span> <span class="dv">10</span>, <span class="at">binwidth =</span> <span class="fl">0.3</span>, <span class="at">linewidth =</span> <span class="fl">0.4</span>,</span>
<span id="cb6-164"><a href="#cb6-164" aria-hidden="true" tabindex="-1"></a>                 <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> <span class="dv">1</span>, <span class="at">by =</span> <span class="fl">0.1</span>))  <span class="sc">+</span></span>
<span id="cb6-165"><a href="#cb6-165" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb6-166"><a href="#cb6-166" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> range_colors, <span class="at">labels =</span> decile_ranges_labs[decile_ranges]) <span class="sc">+</span></span>
<span id="cb6-167"><a href="#cb6-167" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.02</span>, <span class="fl">1.02</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1050</span>), <span class="at">expand =</span> F) <span class="sc">+</span></span>
<span id="cb6-168"><a href="#cb6-168" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> <span class="dv">1</span>, <span class="at">by =</span> <span class="fl">0.1</span>),</span>
<span id="cb6-169"><a href="#cb6-169" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> <span class="dv">1</span>, <span class="at">by =</span> <span class="fl">0.1</span>)) <span class="sc">+</span></span>
<span id="cb6-170"><a href="#cb6-170" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"p-value"</span>, <span class="at">y =</span> <span class="st">"Count"</span>, <span class="at">fill =</span> <span class="st">"Decile interval"</span>) <span class="sc">+</span></span>
<span id="cb6-171"><a href="#cb6-171" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">9</span>),</span>
<span id="cb6-172"><a href="#cb6-172" aria-hidden="true" tabindex="-1"></a>          <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">7</span>),</span>
<span id="cb6-173"><a href="#cb6-173" aria-hidden="true" tabindex="-1"></a>          <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span><span class="dv">8</span>),</span>
<span id="cb6-174"><a href="#cb6-174" aria-hidden="true" tabindex="-1"></a>          <span class="at">legend.key.height =</span> <span class="fu">unit</span>(<span class="fl">0.5</span>, <span class="st">"cm"</span>),</span>
<span id="cb6-175"><a href="#cb6-175" aria-hidden="true" tabindex="-1"></a>          <span class="at">legend.key.width =</span> <span class="fu">unit</span>(<span class="fl">0.5</span>, <span class="st">"cm"</span>),</span>
<span id="cb6-176"><a href="#cb6-176" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb6-177"><a href="#cb6-177" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>))</span>
<span id="cb6-178"><a href="#cb6-178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-179"><a href="#cb6-179" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<p>Let‚Äôs look at the bottom 10% of test statistics under the null distribution.</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_density_decile</span>(<span class="fl">0.1</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="index_files/figure-html/plot_bottom_10-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="499"></p>
</figure>
</div>
</div>
</div>
<p>What is crucial to note is that, because these test statistics represent 10% of the data, the probability that a random draw from the null distribution will fall in this bottom region is 10%, i.e.&nbsp;<span class="math inline">\(P(T \leq t_{_{10\%}}) = p_{_{left}}(t_{_{10\%}})  = 0.1\)</span>, and this is true for any other quantile. Therefore, all statistics <span class="math inline">\(t\)</span> in the first decile interval have probabilities smaller or equal to 0.1: <span class="math inline">\(p_{_{left}}(t) = P(T \le t) \le 0.1 \ \ \forall t \le t_{_{10\%}}\)</span>.</p>
<p>Below, we can visually confirm this by displaying the histogram of left-tailed <em>p</em>-values for all test statistics within the 1st decile interval.</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Left-tailed p-vals</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>left_tailed_pval <span class="ot">&lt;-</span> <span class="fu">sapply</span>(df<span class="sc">$</span>t, <span class="cf">function</span>(t){<span class="fu">table</span>(df<span class="sc">$</span>t <span class="sc">&lt;=</span> t)[<span class="st">"TRUE"</span>]<span class="sc">/</span><span class="dv">10000</span>})</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="do">## Hist of pvals for bottom 10% </span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_pval_hist</span>(<span class="fl">0.1</span>, <span class="st">"left"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="index_files/figure-html/hists_01-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="480"></p>
</figure>
</div>
</div>
</div>
<p>For the subsequent 10% of test statistics‚Äîthose lying between the 1st and 2nd deciles <span class="math inline">\(t_{_{10\%}}\)</span> and <span class="math inline">\(t_{_{20\%}}\)</span>‚Äîtheir <em>p</em>-values lie in the interval (0.1, 0.2]: <span class="math inline">\(0.1 &lt; p_{_{left}}(t) = P(T \le t) \le 0.2 \ \ \forall \ \ t_{_{10\%}} &lt; t \le t_{_{20\%}}\)</span>.</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cowplot)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">plot_density_decile</span>(<span class="fl">0.2</span>)</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">plot_pval_hist</span>(<span class="fl">0.2</span>, <span class="st">"left"</span>)</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_grid</span>(p1, p2, <span class="at">align =</span> <span class="st">"h"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="index_files/figure-html/plots_02-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="979"></p>
</figure>
</div>
</div>
</div>
<p>Because every time we take the same percentage of test statistics lying between the <span class="math inline">\((q-1)\)</span>th and <span class="math inline">\(q\)</span>th deciles for <span class="math inline">\(q = 1,2,3, ..., 10\)</span>, and because their <em>p</em>-values lie in the interval <span class="math inline">\((\frac{q-1}{10}\)</span>, <span class="math inline">\(\frac{q}{10}]\)</span>, each bin in the <em>p</em>-value histogram contains the same proportion of statistics. As a result, the histogram is flat, reflecting the uniform distribution of <em>p</em>-values under the null hypothesis.</p>
<p>See it now, isn‚Äôt? If not, let‚Äôs progressively add more data‚Äî30%, 40%, 50%, and so on, until we reach the full distribution.</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_grid</span>(<span class="fu">plot_density_decile</span>(<span class="fl">0.3</span>), <span class="fu">plot_pval_hist</span>(<span class="fl">0.3</span>, <span class="st">"left"</span>), </span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>          <span class="fu">plot_density_decile</span>(<span class="fl">0.4</span>), <span class="fu">plot_pval_hist</span>(<span class="fl">0.4</span>, <span class="st">"left"</span>), </span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>          <span class="fu">plot_density_decile</span>(<span class="dv">1</span>), <span class="fu">plot_pval_hist</span>(<span class="dv">1</span>, <span class="st">"left"</span>), <span class="at">align =</span> <span class="st">"vh"</span>, <span class="at">ncol =</span> <span class="dv">2</span>, <span class="at">rel_widths =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="fl">0.8</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="index_files/figure-html/plots_03_to_10-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="1152"></p>
</figure>
</div>
</div>
</div>
<section id="mathematical-demonstration" class="level3">
<h3 class="anchored" data-anchor-id="mathematical-demonstration">Mathematical demonstration</h3>
<p>This observation can be formally demonstrated. The <em>probability integral transform</em> theorem states that, for <span class="math inline">\(T\)</span>, a continuous random variable, the random variable for its cumulative distribution function <span class="math inline">\(Y = F_T(T)\)</span> (which returns left-tailed <em>p</em>-values), is uniformly distributed on <span class="math inline">\([0,1]\)</span>.</p>
<p><u>Proof</u>: consider the cumulative distribution function of <span class="math inline">\(Y\)</span>, <span class="math inline">\(F_Y(y) = P(Y \leq y)\)</span>. Because <span class="math inline">\(P(Y \le y) = P(T \le F^{-1}_T(y)) = y\)</span>, then <span class="math inline">\(F_Y(y)=P(Y \le y) = y\)</span> and <span class="math inline">\(Y\)</span> is uniformly distributed.</p>
<div class="callout callout-style-default callout-tip no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>üí° The key here is to note that the probability of observing a <em>p</em>-value less than or equal to <span class="math inline">\(y\)</span> is the same as the probability of observing a test statistic less than or equal to the quantile <span class="math inline">\(F^{-1}_T(y)\)</span> in the null distribution, corresponding to <span class="math inline">\(y\)</span>. That is, <span class="math inline">\(P(Y \le y) = P(T \le F^{-1}_T(y))\)</span>, which is, by definition, <span class="math inline">\(y\)</span>. See example in the code below.</p>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Pr(Y ‚â§ 0.456)</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>pr_Y <span class="ot">=</span> <span class="fu">sum</span>(df<span class="sc">$</span>left_tailed_pval <span class="sc">&lt;=</span> <span class="fl">0.456</span>) <span class="sc">/</span> <span class="fu">length</span>(df<span class="sc">$</span>left_tailed_pval) </span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="do">## Pr(T ‚â§ quantile for 0.456)</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>pr_T <span class="ot">=</span> <span class="fu">sum</span>(df<span class="sc">$</span>t <span class="sc">&lt;=</span> <span class="fu">quantile</span>(df<span class="sc">$</span>t, <span class="fl">0.456</span>)) <span class="sc">/</span> <span class="fu">length</span>(df<span class="sc">$</span>t) </span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>pr_Y <span class="sc">==</span> pr_T</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
</div>
</section>
</section>
<section id="right-tailed-p-values" class="level2">
<h2 class="anchored" data-anchor-id="right-tailed-p-values">Right-tailed <em>p</em>-values</h2>
<p>For right-tailed <em>p</em>-values the pattern is mirrored: for every <span class="math inline">\(t \le t_{_{10\%}}\)</span>, because <span class="math inline">\(P(T \le t) \le 0.1\)</span>, then <span class="math inline">\(p_{_{right}}(t)=P(T&gt;t) =1 - P(T \leq t) \ge 0.9\)</span>. For the second 10% of test statistics <span class="math inline">\(t_{_{10\%}} &lt; t \leq t_{_{20\%}}\)</span>, <span class="math inline">\(0.1&lt;P(T‚â§t)‚â§0.2\)</span> ‚üπ <span class="math inline">\(0.8 \leq p_{_{right}}(t)=P(T&gt;t) =1 - P(T \leq t) &lt; 0.9\)</span>. In general, test statistics between the <span class="math inline">\((q-1)\)</span>th and <span class="math inline">\(q\)</span>th deciles have <em>p</em>-values in <span class="math inline">\([1-\frac{q}{10}\)</span>, <span class="math inline">\(1-\frac{q-1}{10})\)</span>.</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Right-tailed p-vals</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>right_tailed_pval <span class="ot">&lt;-</span> <span class="fu">sapply</span>(df<span class="sc">$</span>t, <span class="cf">function</span>(t){<span class="fu">table</span>(df<span class="sc">$</span>t <span class="sc">&gt;</span> t)[<span class="st">"TRUE"</span>]<span class="sc">/</span><span class="dv">10000</span>})</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>right_tailed_pval <span class="ot">&lt;-</span> <span class="fu">replace</span>(df<span class="sc">$</span>right_tailed_pval, <span class="fu">which</span>(<span class="fu">is.na</span>(df<span class="sc">$</span>right_tailed_pval)), <span class="dv">0</span>)</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_grid</span>(<span class="fu">plot_density_decile</span>(<span class="fl">0.1</span>), <span class="fu">plot_pval_hist</span>(<span class="fl">0.1</span>, <span class="st">"right"</span>), </span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>          <span class="fu">plot_density_decile</span>(<span class="dv">1</span>), <span class="fu">plot_pval_hist</span>(<span class="dv">1</span>, <span class="st">"right"</span>), </span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>          <span class="at">align =</span> <span class="st">"vh"</span>, <span class="at">ncol =</span> <span class="dv">2</span>, <span class="at">rel_widths =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="fl">0.8</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="index_files/figure-html/hists_right_all-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="1152"></p>
</figure>
</div>
</div>
</div>
<section id="mathematical-demonstration-1" class="level3">
<h3 class="anchored" data-anchor-id="mathematical-demonstration-1">Mathematical demonstration</h3>
<p><u>Proof</u>: let <span class="math inline">\(Y_c = 1-Y\)</span> denote the random variable for right-tailed <em>p</em>-values, which is the complement of the random variable for the CDF of <span class="math inline">\(T\)</span>. Consider the CDF of <span class="math inline">\(Y_c\)</span>, <span class="math inline">\(P(Y_c\leq y) = 1 - P(Y_c &gt; y)\)</span>. Because <span class="math inline">\(P(Y_c &gt; y) = P(T \leq F^{-1}_T(1-y)) = 1-y\)</span>, then <span class="math inline">\(P(Y_c\leq y) = 1 -(1-y)=y\)</span> and both, <span class="math inline">\(Y\)</span> and its complement <span class="math inline">\(Y_c\)</span>, follow a uniform distribution.</p>
<div class="callout callout-style-default callout-tip no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>üí° The key point here is that right-tailed <em>p</em>-values greater than <span class="math inline">\(y\)</span> correspond to the bottom <span class="math inline">\(1-y\)</span> proportion of test statistics in the null distribution, so that <span class="math inline">\(P(Y_c &gt; y) = P(T \leq F^{-1}_T(1-y))\)</span>, which, by definition, equals <span class="math inline">\(1-y\)</span>.</p>
</div>
</div>
</section>
</section>
<section id="two-tailed-p-values" class="level2">
<h2 class="anchored" data-anchor-id="two-tailed-p-values">Two-tailed <em>p</em>-values</h2>
<p>For data points within intervals of deciles <span class="math inline">\(q ‚àà \{1,2,3,4,5\}\)</span>, their two-tailed <em>p</em>-values lie between <span class="math inline">\(\frac{q-1}{10}\times 2\)</span> and <span class="math inline">\(\frac{q}{10}\times 2\)</span>, whereas for those above the 5th decile, <em>p</em>-values lie between <span class="math inline">\((1-\frac{q-1}{10})\times 2\)</span> and <span class="math inline">\((1-\frac{q}{10})\times 2\)</span>.</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Right-tailed p-vals</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="co"># df$two_tailed_pval &lt;- apply(df, 1, function(x){2*as.double(min(x["left_tailed_pval"], x["right_tailed_pval"]))})</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="co"># ## Hist of pvals for bottom 10% data points</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="co"># p1 &lt;- plot_pval_hist(0.1, "both") +  guides(fill = guide_legend(reverse = TRUE))</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a><span class="co"># p2 &lt;- plot_pval_hist(0.2, "both") +  guides(fill = guide_legend(reverse = TRUE))</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="co"># p3 &lt;- plot_pval_hist(0.6, "both") +  guides(fill = guide_legend(reverse = TRUE))</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a><span class="co"># p4 &lt;- plot_pval_hist(1, "both") +  guides(fill = guide_legend(reverse = TRUE))</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a><span class="co"># plot_grid(p1, p2, p3, p4, align = "h", ncol = 1)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<section id="mathematical-demonstration-2" class="level3">
<h3 class="anchored" data-anchor-id="mathematical-demonstration-2">Mathematical demonstration</h3>
<p><u>Proof</u>: let <span class="math inline">\(Y_l\)</span> and <span class="math inline">\(Y_r\)</span> be the random variables for two-tailed <em>p</em>-values for observations of <span class="math inline">\(X\)</span> below and above the 5th decile, respectively (bottom and top half of previous histogram, respectively). Let <span class="math inline">\(Y_t\)</span> be the random variable for two-tailed <em>p</em>-values across all observations (the complete histogram). The CDF of <span class="math inline">\(Y_t\)</span> is <span class="math inline">\(P(Y_t \leq y) = \frac{P(Y_l \leq y)}{2} + \frac{P(Y_r \leq y)}{2} = P(Y \leq \frac{y}{2}) + P(Y_c \leq \frac{y}{2})\)</span>. Because <span class="math inline">\(Y\)</span> and <span class="math inline">\(Y_c\)</span> are uniformly distributed, the latter equals to <span class="math inline">\(\frac{y}{2} + \frac{y}{2}\)</span> so <span class="math inline">\(P(Y_t \leq y) = y\)</span> and is thus also uniformly distributed.</p>
<ul>
<li>Relate to theorem and CDF and PDF: <a href="https://matthewfeickert.github.io/Statistics-Notes/notebooks/Introductory/probability-integral-transform.html" class="uri">https://matthewfeickert.github.io/Statistics-Notes/notebooks/Introductory/probability-integral-transform.html</a></li>
</ul>
<p>Ideas:</p>
</section>
<section id="when-p-values-are-uniformly-distributed" class="level3">
<h3 class="anchored" data-anchor-id="when-p-values-are-uniformly-distributed"><strong>When p-values&nbsp;<em>are</em>&nbsp;uniformly distributed</strong></h3>
<ul>
<li><p><strong>Under the null hypothesis</strong>&nbsp;is&nbsp;<em>true</em></p></li>
<li><p><strong>The test statistic‚Äôs reference distribution is correct</strong>&nbsp;(e.g., you‚Äôre actually using the right t-distribution, œá¬≤ distribution, etc.)</p></li>
<li><p><strong>No p-hacking</strong>&nbsp;or data snooping has been done</p></li>
<li><p><strong>Continuous</strong>&nbsp;test statistic (ties complicate things)</p></li>
</ul>
<p>In that ideal case,</p>
<p>P(p‚â§Œ±)=Œ±</p>
<p>for all&nbsp;Œ±‚àà[0,1]Œ±‚àà[0,1],<br>
meaning the p-value follows a Uniform(0,1) distribution.</p>
<hr>
</section>
<section id="when-they-are-not-uniformly-distributed" class="level3">
<h3 class="anchored" data-anchor-id="when-they-are-not-uniformly-distributed"><strong>When they are&nbsp;<em>not</em>&nbsp;uniformly distributed</strong></h3>
<ul>
<li><p><strong>Null hypothesis is false</strong>&nbsp;‚Üí p-values are&nbsp;<em>stochastically smaller</em>&nbsp;(skewed toward 0)</p></li>
<li><p><strong>Model assumptions are violated</strong>&nbsp;(wrong reference distribution, heteroscedasticity, etc.) ‚Üí distribution can be distorted in unpredictable ways</p></li>
<li><p><strong>Discrete test statistics</strong>&nbsp;(e.g., Fisher‚Äôs exact test) ‚Üí distribution is ‚Äústepped‚Äù and not perfectly uniform</p></li>
<li><p><strong>Multiple testing without correction</strong>&nbsp;‚Üí aggregated p-values no longer follow a simple uniform distribution</p></li>
<li><p><strong>Selection bias / p-hacking</strong>&nbsp;‚Üí distribution can become heavily biased toward small values</p></li>
</ul>
<hr>
<p>‚úÖ&nbsp;<strong>Bottom line:</strong><br>
P-values are&nbsp;<em>theoretically</em>&nbsp;Uniform(0,1)&nbsp;<strong>only under the null and correct modeling assumptions</strong>.<br>
The reference distribution does matter ‚Äî if it‚Äôs wrong, the uniformity breaks.</p>
</section>
</section>
</section>
<section id="conclusion" class="level1">
<h1>Conclusion</h1>
<p>The cases where the p-values ar enot uniformly distributed have been discussed in. This is the formal basis of p-values being uniform: by definition they are CDF evaluations of observed statistics.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "Óßã";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/daianna21\.github\.io\/daianna_blog\/");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<input type="hidden" id="giscus-base-theme" value="light">
<input type="hidden" id="giscus-alt-theme" value="dark">
<script>
  function loadGiscus() {
    // Function to get the theme based on body class
    const getTheme = () => {
      let baseTheme = document.getElementById('giscus-base-theme').value;
      let altTheme = document.getElementById('giscus-alt-theme').value;
      return document.body.classList.contains('quarto-dark') ? altTheme : baseTheme;
    };
    const script = document.createElement("script");
    script.src = "https://giscus.app/client.js";
    script.async = true;
    script.dataset.repo = "lahuuki/lahuuki.github.io";
    script.dataset.repoId = "MDEwOlJlcG9zaXRvcnkzNDM1NTI0NjA=";
    script.dataset.category = "General";
    script.dataset.categoryId = "DIC_kwDOFHoxzM4CfkDR";
    script.dataset.mapping = "title";
    script.dataset.reactionsEnabled = "1";
    script.dataset.emitMetadata = "0";
    script.dataset.inputPosition = "top";
    script.dataset.theme = getTheme();
    script.dataset.lang = "en";
    script.crossOrigin = "anonymous";
    // Append the script to the desired div instead of at the end of the body
    document.getElementById("quarto-content").appendChild(script);
  }
  loadGiscus();
</script>
</div> <!-- /content -->




</body></html>